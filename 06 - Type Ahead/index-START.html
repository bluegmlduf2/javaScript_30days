<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
  <script>
    const endpoint =
      'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    /*
      fetchëŠ” ES6ë¶€í„° ì‚¬ìš©ë¨. promiseë¥¼ ë°˜í™˜í•œë‹¤.
      fetch APIë¥¼ ì°¸ê³ .
      fat Arrow functionì°¸ê³ . ()=>{return a;}
    */
    const cities = [];

    /*endpoint->cities*/
    fetch(endpoint).then(
      obj => obj.json()
    ).then(
      /* data -> obj.json().arr[0] */
      data => cities.push(...data) // ..data ->['1']['2']['3'].. 
    )

    /*findMatchesë©”ì„œë“œì˜ ë°˜í™˜í˜• filterì˜ ê²°ê³¼*/
    const findMatches = (input) => {
      //ë°°ì—´obj.filter(function(obj){ruturn obj.a='1'})
      return cities.filter(obj => {
        const reg = new RegExp(input, 'gi'); //gëŠ” ë¬¸ìì—´ì† ì¼ì¹˜í•˜ëŠ” ê°’ ì „ë¶€ê°€ì ¸ì˜´, iëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì•ˆí•¨
        /*filter ë©”ì„œë“œì—ì„œ í•„ìš”í•œ return*/
        return obj.city.match(reg)||obj.state.match(reg); //ë¬¸ìì—´obj.city.match(ì •ê·œí˜•obj) ë¬¸ìì—´obj.cityì—ì„œ regì™€ ì¼ì¹˜í•˜ëŠ” ê°’ì„ êµ¬í•œë‹¤. 
        /* 
          return A or B;
          A,Bë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ì°¸(true)ì´ ìˆë‹¤ë©´ ì°¸ì˜ ê°’ì„ ë°˜í™˜í•œë‹¤.
          ì¦‰, city,state ë‘˜ì¤‘ ì¼ì¹˜í•˜ëŠ” ì •ë³´ê°€ ìˆìœ¼ë©´ ì°¸ì´ ë˜ê³  í•´ë‹¹ì •ë³´ ë°˜í™˜.
          return A || B : ë¦¬í„´ë¬¸ìœ¼ë¡œ A||Bë¡œ ë°˜í™˜ì´ ëœë‹¤ëŠ” ì ì„ ì£¼ëª©
        */
      })
    }

    /*ìˆ«ì 3ìë¦¬ë§ˆë‹¤ ì»´ë§ˆ í‘œì‹œ*/
    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    
    const search=document.querySelector('.search');
    const suggestions=document.querySelector('.suggestions');


    function displayFunc(){
      let inputValue=this.value;
      let matchedCities=findMatches(inputValue);

      const reg = new RegExp(this.value, 'gi'); //replaceë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•¨
      
      //ë™ì ì¸ html ìƒì„±ì‹œ map().join('')ì„ ë§ì´ ì‚¬ìš©í•¨
      const createdDom=matchedCities.map(obj=>{
        let spanTagCity=obj.city.replace(reg,`<span class="hl">${this.value}</span>`);
        //obj.cityì¤‘ì— ì…ë ¥í•œ ë„ì‹œëª…ê³¼ ì¼ì¹˜í•œë‹¤ë©´ í•´ë‹¹ í–‰ì„ <span>..</span>ìœ¼ë¡œ ë³€ê²½, ë˜í•œ ì—¬ê¸°ì„œ this.valueëŠ” obj.cityì´ë‹¤.
        let spanTagState=obj.state.replace(reg,`<span class="hl">${this.value}</span>`);
        return `
          <li>
            <span class="name">${spanTagCity}, ${spanTagState}</span>
            <span class="population">${numberWithCommas(obj.population)}</span>
          </li>
        `;
      }).join(''); //ë°°ì—´.join('') -->ë°°ì—´ë“¤ì„ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ í•©ì¹œë‹¤. ['a','b','c'].join('/') ==> "a/b/c"

      suggestions.innerHTML=createdDom
    }

    search.addEventListener('change',displayFunc);
    search.addEventListener('keyup',displayFunc);

    //push(...data) //=> push(['1']['2']['3']['4']..)
    /*
      export class a(){
        static props = {
          className: '',
          name: 'ì €ì¥',
          onClick: () => {}
        }
        
        render() {
          let { className, ...props } = this.props; 
          //className --> ''
          //...props --> name,onclick()
        }
      }
    */
  </script>
</body>

</html>